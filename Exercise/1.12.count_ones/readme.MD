# [1-12] 

## 计算 `unsigned int` 数字中 `bit 1` 的个数

大体思路是将数字 `n` 本身作为一个 `32bit` 的计数器 (`parallel counter`)。

计算时，n 已经不再作为一个 `unsigned int`， 而是一个分区段的计数器：

1. 第一轮是将n分作16段长度2的计数器；将原 `2 bit` 内的 `bit 1` 个数求出来，直接存到这个 `2 bit` 内；因为 `2个bit` 最多有2个 `bit 1`， 而 `(11)b` 可以表示数值 `0~3`，可以正确存储 `bit 1` 的数量。
2. 第二轮是8段长度4的计数器
3. 第三轮是4段长度8的计数器
4. 第四轮是2段长度16的计数器
5. 而当第五轮时，两个计数器内数值相加，得到一个32位的计数器，这时也恰好就是一个 `unsigned int` 数字，表示了原值中 `bit 1` 的个数

真的很难表述。。。

以 `n=0xFFFFFFFF` 为例：

```
$ ./1.12.count_ones.exe
sizeof unsigned long=4
unsigned long -1=0xFFFFFFFF=1111 1111 1111 1111 1111 1111 1111 1111
mask(0)=1431655765
=0x55555555=0101 0101 0101 0101 0101 0101 0101 0101
mask(1)=858993459
=0x33333333=0011 0011 0011 0011 0011 0011 0011 0011
mask(2)=252645135
=0x0F0F0F0F=0000 1111 0000 1111 0000 1111 0000 1111
mask(3)=16711935
=0x00FF00FF=0000 0000 1111 1111 0000 0000 1111 1111
mask(4)=65535
=0x0000FFFF=0000 0000 0000 0000 1111 1111 1111 1111

round0 n=-1
--------------  ----------=FEDC BA98 7654 3210 FEDC BA98 7654 3210
round0 ---n=    0xFFFFFFFF=1111 1111 1111 1111 1111 1111 1111 1111
round0 mask=    0x55555555=0101 0101 0101 0101 0101 0101 0101 0101
round0 pow=     0x00000001=0000 0000 0000 0000 0000 0000 0000 0001
round0 ppc=     0x00000002=0000 0000 0000 0000 0000 0000 0000 0010
round0 n&mc=    0x55555555=0101 0101 0101 0101 0101 0101 0101 0101
round0 n>>pc=   0x7FFFFFFF=0111 1111 1111 1111 1111 1111 1111 1111
round0 &=mc=    0x55555555=0101 0101 0101 0101 0101 0101 0101 0101
round0 ret=     0xAAAAAAAA=1010 1010 1010 1010 1010 1010 1010 1010

round1 n=-1431655766
--------------  ----------=FEDC BA98 7654 3210 FEDC BA98 7654 3210
round1 ---n=    0xAAAAAAAA=1010 1010 1010 1010 1010 1010 1010 1010
round1 mask=    0x33333333=0011 0011 0011 0011 0011 0011 0011 0011
round1 pow=     0x00000002=0000 0000 0000 0000 0000 0000 0000 0010
round1 ppc=     0x00000004=0000 0000 0000 0000 0000 0000 0000 0100
round1 n&mc=    0x22222222=0010 0010 0010 0010 0010 0010 0010 0010
round1 n>>pc=   0x2AAAAAAA=0010 1010 1010 1010 1010 1010 1010 1010
round1 &=mc=    0x22222222=0010 0010 0010 0010 0010 0010 0010 0010
round1 ret=     0x44444444=0100 0100 0100 0100 0100 0100 0100 0100

round2 n=1145324612
--------------  ----------=FEDC BA98 7654 3210 FEDC BA98 7654 3210
round2 ---n=    0x44444444=0100 0100 0100 0100 0100 0100 0100 0100
round2 mask=    0x0F0F0F0F=0000 1111 0000 1111 0000 1111 0000 1111
round2 pow=     0x00000004=0000 0000 0000 0000 0000 0000 0000 0100
round2 ppc=     0x00000010=0000 0000 0000 0000 0000 0000 0001 0000
round2 n&mc=    0x04040404=0000 0100 0000 0100 0000 0100 0000 0100
round2 n>>pc=   0x04444444=0000 0100 0100 0100 0100 0100 0100 0100
round2 &=mc=    0x04040404=0000 0100 0000 0100 0000 0100 0000 0100
round2 ret=     0x08080808=0000 1000 0000 1000 0000 1000 0000 1000

round3 n=134744072
--------------  ----------=FEDC BA98 7654 3210 FEDC BA98 7654 3210
round3 ---n=    0x08080808=0000 1000 0000 1000 0000 1000 0000 1000
round3 mask=    0x00FF00FF=0000 0000 1111 1111 0000 0000 1111 1111
round3 pow=     0x00000008=0000 0000 0000 0000 0000 0000 0000 1000
round3 ppc=     0x00000100=0000 0000 0000 0000 0000 0001 0000 0000
round3 n&mc=    0x00080008=0000 0000 0000 1000 0000 0000 0000 1000
round3 n>>pc=   0x00080808=0000 0000 0000 1000 0000 1000 0000 1000
round3 &=mc=    0x00080008=0000 0000 0000 1000 0000 0000 0000 1000
round3 ret=     0x00100010=0000 0000 0001 0000 0000 0000 0001 0000

round4 n=1048592
--------------  ----------=FEDC BA98 7654 3210 FEDC BA98 7654 3210
round4 ---n=    0x00100010=0000 0000 0001 0000 0000 0000 0001 0000
round4 mask=    0x0000FFFF=0000 0000 0000 0000 1111 1111 1111 1111
round4 pow=     0x00000010=0000 0000 0000 0000 0000 0000 0001 0000
round4 ppc=     0x00010000=0000 0000 0000 0001 0000 0000 0000 0000
round4 n&mc=    0x00000010=0000 0000 0000 0000 0000 0000 0001 0000
round4 n>>pc=   0x00000010=0000 0000 0000 0000 0000 0000 0001 0000
round4 &=mc=    0x00000010=0000 0000 0000 0000 0000 0000 0001 0000
round4 ret=     0x00000020=0000 0000 0000 0000 0000 0000 0010 0000
```

